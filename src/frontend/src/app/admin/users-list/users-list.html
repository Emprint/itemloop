<div class="users-list">
  <h2>{{ 'USER_MANAGEMENT' | translate }}</h2>
  @if (errorMessage()) {
    <div class="error">{{ errorMessage() }}</div>
  }

  @if (showReLoginNotice) {
    <div class="error">
      You have updated your password. Please <a href="/auth/login">login again</a> to continue using
      the app.
    </div>
  }

  @if (showForm) {
    <div class="form-card">
      <h3>{{ selectedUser ? ('EDIT_USER' | translate) : ('NEW_USER' | translate) }}</h3>
      <form [formGroup]="form" (ngSubmit)="saveUser()" autocomplete="off">
        <label for="name">{{ 'NAME' | translate }}:</label>
        <input formControlName="name" id="name" type="text" required autocomplete="off" />

        <label for="email">{{ 'EMAIL' | translate }}:</label>
        <input formControlName="email" id="email" type="email" required autocomplete="off" />

        <label for="role">{{ 'ROLE' | translate }}:</label>
        <select formControlName="role" id="role" autocomplete="off">
          <option value="customer">{{ 'CUSTOMER' | translate }}</option>
          <option value="editor">{{ 'EDITOR' | translate }}</option>
          <option value="admin">{{ 'ADMIN' | translate }}</option>
        </select>

        <label for="password"
          >{{ selectedUser ? ('CHANGE_PASSWORD' | translate) : ('PASSWORD' | translate) }}:</label
        >
        <div style="position: relative">
          <input
            formControlName="password"
            id="password"
            [type]="showPassword ? 'text' : 'password'"
            autocomplete="new-password"
          />
          <button type="button" (click)="togglePassword()" class="hide-password-button">
            {{ showPassword ? ('HIDE' | translate) : ('SHOW' | translate) }}
          </button>
        </div>

        <div class="buttons-list">
          <button type="button" (click)="cancel()">{{ 'CANCEL' | translate }}</button>
          <button type="submit">{{ 'SAVE' | translate }}</button>
        </div>
      </form>
    </div>
  }

  @if (!showForm && !showReLoginNotice) {
    <button (click)="newUserForm()">{{ 'NEW_USER_BTN' | translate }}</button>
    <table class="item-table">
      <thead>
        <tr>
          <th>{{ 'NAME' | translate }}</th>
          <th>{{ 'EMAIL' | translate }}</th>
          <th>{{ 'ROLE' | translate }}</th>
          <th style="width: 90px">{{ 'ACTIONS' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        @for (user of users(); track user.id) {
          <tr>
            <td>{{ user.name }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.role | uppercase | translate }}</td>
            <td>
              <span style="display: flex; gap: 0.3em; align-items: center">
                <button class="compact-button" (click)="selectUser(user)">
                  {{ 'EDIT' | translate }}
                </button>
                <button
                  class="compact-button"
                  (click)="confirmDeleteUser(user)"
                  [disabled]="isLastAdmin(user)"
                >
                  {{ 'DELETE' | translate }}
                </button>
              </span>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }
</div>

<app-confirm-modal
  [show]="showDeleteModal"
  [message]="
    'Are you sure you want to delete the user &quot;' + (userToDelete?.name || '') + '&quot;?'
  "
  (confirmEvent)="deleteUserConfirmed()"
  (cancelEvent)="cancelDeleteUser()"
></app-confirm-modal>
